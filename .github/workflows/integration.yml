---
name: CI
on:
  push:
    branches:
    - main
    tags:
    - 'v*'
  pull_request:
permissions: {}
jobs:
  ##############################################################################
  # Path Filter
  ##############################################################################
  path-filter:
    name: Path Filter
    runs-on: ubuntu-latest
    timeout-minutes: 3
    permissions:
      contents: read
      pull-requests: read
    outputs:
      application: ${{ steps.changes.outputs.application }}
      renovate-config-validator: ${{ steps.changes.outputs.renovate-config-validator }}
      reviewdog-actionlint: ${{ steps.changes.outputs.reviewdog-actionlint }}
      reviewdog-editorconfig-checker: ${{ steps.changes.outputs.reviewdog-editorconfig-checker }}
      reviewdog-gjson-validate: ${{ steps.changes.outputs.reviewdog-gjson-validate }}
      reviewdog-gofmt: ${{ steps.changes.outputs.reviewdog-gofmt }}
      reviewdog-gosec: ${{ steps.changes.outputs.reviewdog-gosec }}
      reviewdog-govet: ${{ steps.changes.outputs.reviewdog-govet }}
      reviewdog-gyaml-validate: ${{ steps.changes.outputs.reviewdog-gyaml-validate }}
      reviewdog-shellcheck: ${{ steps.changes.outputs.reviewdog-shellcheck }}
      reviewdog-shfmt: ${{ steps.changes.outputs.reviewdog-shfmt }}
      reviewdog-staticcheck: ${{ steps.changes.outputs.reviewdog-staticcheck }}
    steps:
    - name: Checkout
      uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
    - name: Path Filter
      id: changes
      uses: dorny/paths-filter@de90cc6fb38fc0963ad72b210f1f284cd68cea36 # v3.0.2
      with:
        filters: .github/filters.yml
  ##############################################################################
  # Workflow Calls
  ##############################################################################
  application:
    name: Application
    needs: path-filter
    if: ${{ github.ref_name == 'main' || needs.path-filter.outputs.application == 'true' }}
    permissions:
      contents: write
      pull-requests: write
    uses: ./.github/workflows/application.yml
  renovate-config-validator:
    name: Renovate Config Validator
    needs: path-filter
    if: ${{ github.ref_name == 'main' || needs.path-filter.outputs.renovate-config-validator == 'true' }}
    permissions:
      contents: read
    uses: ./.github/workflows/renovate-config-validator.yml
  reviewdog-actionlint:
    name: Reviewdog (actionlint)
    needs: path-filter
    if: ${{ github.ref_name == 'main' || needs.path-filter.outputs.reviewdog-actionlint == 'true' }}
    permissions:
      contents: read
      checks: write
      pull-requests: write
    uses: ./.github/workflows/reviewdog-actionlint.yml
  reviewdog-editorconfig-checker:
    name: Reviewdog (editorconfig-checker)
    needs: path-filter
    if: ${{ github.ref_name == 'main' || needs.path-filter.outputs.reviewdog-editorconfig-checker == 'true' }}
    permissions:
      contents: read
      checks: write
      pull-requests: write
    uses: ./.github/workflows/reviewdog-editorconfig-checker.yml
  reviewdog-gjson-validate:
    name: Reviewdog (gjson-validate)
    needs: path-filter
    if: ${{ github.ref_name == 'main' || needs.path-filter.outputs.reviewdog-gjson-validate == 'true' }}
    permissions:
      contents: read
      checks: write
      pull-requests: write
    uses: ./.github/workflows/reviewdog-gjson-validate.yml
  reviewdog-gyaml-validate:
    name: Reviewdog (gyaml-validate)
    needs: path-filter
    if: ${{ github.ref_name == 'main' || needs.path-filter.outputs.reviewdog-gyaml-validate == 'true' }}
    permissions:
      contents: read
      checks: write
      pull-requests: write
    uses: ./.github/workflows/reviewdog-gyaml-validate.yml
  reviewdog-gofmt:
    name: Reviewdog (gofmt)
    needs: path-filter
    if: ${{ github.ref_name == 'main' || needs.path-filter.outputs.reviewdog-gofmt == 'true' }}
    permissions:
      contents: read
      checks: write
      pull-requests: write
    uses: ./.github/workflows/reviewdog-gofmt.yml
  reviewdog-gosec:
    name: Reviewdog (gosec)
    needs: path-filter
    if: ${{ github.ref_name == 'main' || needs.path-filter.outputs.reviewdog-gosec == 'true' }}
    permissions:
      contents: read
      checks: write
      pull-requests: write
    uses: ./.github/workflows/reviewdog-gosec.yml
  reviewdog-govet:
    name: Reviewdog (govet)
    needs: path-filter
    if: ${{ github.ref_name == 'main' || needs.path-filter.outputs.reviewdog-govet == 'true' }}
    permissions:
      contents: read
      checks: write
      pull-requests: write
    uses: ./.github/workflows/reviewdog-govet.yml
  reviewdog-shellcheck:
    name: Reviewdog (shellcheck)
    needs: path-filter
    if: ${{ github.ref_name == 'main' || needs.path-filter.outputs.reviewdog-shellcheck == 'true' }}
    permissions:
      contents: read
      checks: write
      pull-requests: write
    uses: ./.github/workflows/reviewdog-shellcheck.yml
  reviewdog-shfmt:
    name: Reviewdog (shfmt)
    needs: path-filter
    if: ${{ github.ref_name == 'main' || needs.path-filter.outputs.reviewdog-shfmt == 'true' }}
    permissions:
      contents: read
      checks: write
      pull-requests: write
    uses: ./.github/workflows/reviewdog-shfmt.yml
  reviewdog-staticcheck:
    name: Reviewdog (staticcheck)
    needs: path-filter
    if: ${{ github.ref_name == 'main' || needs.path-filter.outputs.reviewdog-staticcheck == 'true' }}
    permissions:
      contents: read
      checks: write
      pull-requests: write
    uses: ./.github/workflows/reviewdog-staticcheck.yml
  ##############################################################################
  # Status Check
  ##############################################################################
  ci:
    needs:
    - application
    - renovate-config-validator
    - reviewdog-actionlint
    - reviewdog-editorconfig-checker
    - reviewdog-gjson-validate
    - reviewdog-gofmt
    - reviewdog-gosec
    - reviewdog-govet
    - reviewdog-gyaml-validate
    - reviewdog-shellcheck
    - reviewdog-shfmt
    - reviewdog-staticcheck
    name: CI
    runs-on: ubuntu-latest
    timeout-minutes: 3
    if: failure()
    steps:
    - name: Failure Status
      run: exit 1
